{
  "info": {
    "name": "Email Gateway API",
    "description": "Complete API collection for the Email Gateway service. Includes authentication, email sending, status checking, and admin monitoring endpoints.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "version": "1.0.0"
  },
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{jwt_token}}",
        "type": "string"
      }
    ]
  },
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:3000",
      "type": "string"
    },
    {
      "key": "jwt_token",
      "value": "",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "Authentication",
      "item": [
        {
          "name": "Get JWT Token",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/test-token",
              "host": ["{{base_url}}"],
              "path": ["test-token"]
            },
            "description": "Get a JWT token for API authentication. This is a development endpoint that generates a test token valid for 1 hour."
          },
          "response": [
            {
              "name": "Success Response",
              "originalRequest": {
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{base_url}}/test-token",
                  "host": ["{{base_url}}"],
                  "path": ["test-token"]
                }
              },
              "status": "OK",
              "code": 200,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "cookie": [],
              "body": "{\n  \"token\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n  \"expiresIn\": \"1 hour\"\n}"
            }
          ]
        }
      ]
    },
    {
      "name": "Email Operations",
      "item": [
        {
          "name": "Send Email - Universal Template",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}"
              },
              {
                "key": "Idempotency-Key",
                "value": "{{$timestamp}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"from\": {\n    \"email\": \"marketing@waymore.io\",\n    \"name\": \"Waymore Team\"\n  },\n  \"subject\": \"Welcome to Waymore Platform\",\n  \"template\": {\n    \"key\": \"universal\",\n    \"locale\": \"en\"\n  },\n  \"to\": [\n    {\n      \"email\": \"recipient@example.com\",\n      \"name\": \"Recipient Name\"\n    }\n  ],\n  \"variables\": {\n    \"title\": \"Welcome to Waymore\",\n    \"details\": \"Thank you for joining our platform. We're excited to have you on board!\",\n    \"status\": \"New User\",\n    \"provider\": \"Waymore Platform\"\n  }\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/api/v1/emails",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "emails"]
            },
            "description": "Send an email using the universal template. This is the main endpoint for sending emails through the gateway."
          },
          "response": [
            {
              "name": "Success Response",
              "originalRequest": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  },
                  {
                    "key": "Authorization",
                    "value": "Bearer {{jwt_token}}"
                  },
                  {
                    "key": "Idempotency-Key",
                    "value": "{{$timestamp}}"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n  \"from\": {\n    \"email\": \"marketing@waymore.io\",\n    \"name\": \"Waymore Team\"\n  },\n  \"subject\": \"Welcome to Waymore Platform\",\n  \"template\": {\n    \"key\": \"universal\",\n    \"locale\": \"en\"\n  },\n  \"to\": [\n    {\n      \"email\": \"recipient@example.com\",\n      \"name\": \"Recipient Name\"\n    }\n  ],\n  \"variables\": {\n    \"title\": \"Welcome to Waymore\",\n    \"details\": \"Thank you for joining our platform. We're excited to have you on board!\",\n    \"status\": \"New User\",\n    \"provider\": \"Waymore Platform\"\n  }\n}",
                  "options": {
                    "raw": {
                      "language": "json"
                    }
                  }
                },
                "url": {
                  "raw": "{{base_url}}/api/v1/emails",
                  "host": ["{{base_url}}"],
                  "path": ["api", "v1", "emails"]
                }
              },
              "status": "Accepted",
              "code": 202,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "cookie": [],
              "body": "{\n  \"messageId\": \"msg_abc123\",\n  \"status\": \"queued\"\n}"
            }
          ]
        },
        {
          "name": "Send Email - Multiple Recipients",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}"
              },
              {
                "key": "Idempotency-Key",
                "value": "{{$timestamp}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"from\": {\n    \"email\": \"marketing@waymore.io\",\n    \"name\": \"Waymore Team\"\n  },\n  \"subject\": \"Important Update\",\n  \"template\": {\n    \"key\": \"universal\",\n    \"locale\": \"en\"\n  },\n  \"to\": [\n    {\n      \"email\": \"user1@example.com\",\n      \"name\": \"User One\"\n    },\n    {\n      \"email\": \"user2@example.com\",\n      \"name\": \"User Two\"\n    }\n  ],\n  \"cc\": [\n    {\n      \"email\": \"manager@example.com\",\n      \"name\": \"Manager\"\n    }\n  ],\n  \"variables\": {\n    \"title\": \"Important Update\",\n    \"details\": \"We have an important update regarding your account.\",\n    \"status\": \"Update Required\",\n    \"provider\": \"Waymore Platform\"\n  }\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/api/v1/emails",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "emails"]
            },
            "description": "Send an email to multiple recipients with CC."
          }
        },
        {
          "name": "Send Email - With Webhook URL",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}"
              },
              {
                "key": "Idempotency-Key",
                "value": "{{$timestamp}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"from\": {\n    \"email\": \"marketing@waymore.io\",\n    \"name\": \"Waymore Team\"\n  },\n  \"subject\": \"Email with Webhook\",\n  \"template\": {\n    \"key\": \"universal\",\n    \"locale\": \"en\"\n  },\n  \"to\": [\n    {\n      \"email\": \"recipient@example.com\",\n      \"name\": \"Recipient Name\"\n    }\n  ],\n  \"webhookUrl\": \"https://your-app.com/webhooks/email-status\",\n  \"variables\": {\n    \"title\": \"Webhook Test\",\n    \"details\": \"This email includes webhook notifications for status updates.\",\n    \"status\": \"Webhook Enabled\",\n    \"provider\": \"Waymore Platform\"\n  }\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/api/v1/emails",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "emails"]
            },
            "description": "Send an email with a webhook URL for status notifications."
          }
        }
      ]
    },
    {
      "name": "Message Status",
      "item": [
        {
          "name": "Get Message Status",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/api/v1/messages/{{message_id}}",
              "host": ["{{base_url}}"],
              "path": ["api", "v1", "messages", "{{message_id}}"]
            },
            "description": "Get the current status of a specific message by its ID."
          },
          "response": [
            {
              "name": "Success Response",
              "originalRequest": {
                "method": "GET",
                "header": [
                  {
                    "key": "Authorization",
                    "value": "Bearer {{jwt_token}}"
                  }
                ],
                "url": {
                  "raw": "{{base_url}}/api/v1/messages/msg_abc123",
                  "host": ["{{base_url}}"],
                  "path": ["api", "v1", "messages", "msg_abc123"]
                }
              },
              "status": "OK",
              "code": 200,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "cookie": [],
              "body": "{\n  \"messageId\": \"msg_abc123\",\n  \"status\": \"sent\",\n  \"attempts\": 1,\n  \"lastError\": null,\n  \"createdAt\": \"2025-09-25T16:30:00Z\",\n  \"updatedAt\": \"2025-09-25T16:30:05Z\"\n}"
            }
          ]
        }
      ]
    },
    {
      "name": "System Health",
      "item": [
        {
          "name": "Health Check",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/health",
              "host": ["{{base_url}}"],
              "path": ["health"]
            },
            "description": "Check the health status of the email gateway service."
          },
          "response": [
            {
              "name": "Success Response",
              "originalRequest": {
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{base_url}}/health",
                  "host": ["{{base_url}}"],
                  "path": ["health"]
                }
              },
              "status": "OK",
              "code": 200,
              "_postman_previewlanguage": "json",
              "header": [
                {
                  "key": "Content-Type",
                  "value": "application/json"
                }
              ],
              "cookie": [],
              "body": "{\n  \"status\": \"healthy\",\n  \"timestamp\": \"2025-09-25T16:30:00Z\",\n  \"uptime\": 3600\n}"
            }
          ]
        },
        {
          "name": "Readiness Check",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/readyz",
              "host": ["{{base_url}}"],
              "path": ["readyz"]
            },
            "description": "Check if the service is ready to accept requests."
          }
        },
        {
          "name": "Metrics",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/metrics",
              "host": ["{{base_url}}"],
              "path": ["metrics"]
            },
            "description": "Get system metrics and statistics."
          }
        }
      ]
    },
    {
      "name": "Admin Dashboard",
      "item": [
        {
          "name": "Admin Dashboard",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/admin",
              "host": ["{{base_url}}"],
              "path": ["admin"]
            },
            "description": "Access the admin dashboard for monitoring email delivery status and system health."
          }
        },
        {
          "name": "Admin API Data",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/admin/api/data",
              "host": ["{{base_url}}"],
              "path": ["admin", "api", "data"]
            },
            "description": "Get real-time data for the admin dashboard (JSON API endpoint)."
          }
        }
      ]
    },
    {
      "name": "Webhooks",
      "item": [
        {
          "name": "Routee Webhook (Simulate)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"events\": [\n    {\n      \"trackingId\": \"{{provider_message_id}}\",\n      \"eventType\": \"delivered\",\n      \"timestamp\": \"{{$isoTimestamp}}\",\n      \"details\": {\n        \"recipient\": \"recipient@example.com\",\n        \"deliveryTime\": \"{{$isoTimestamp}}\"\n      }\n    }\n  ]\n}",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/webhooks/routee",
              "host": ["{{base_url}}"],
              "path": ["webhooks", "routee"]
            },
            "description": "Simulate a Routee webhook event for testing status updates."
          }
        }
      ]
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Auto-generate idempotency key if not set",
          "if (!pm.request.headers.get('Idempotency-Key')) {",
          "    pm.request.headers.add({",
          "        key: 'Idempotency-Key',",
          "        value: 'postman-' + Date.now()",
          "    });",
          "}"
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Auto-extract JWT token from test-token response",
          "if (pm.response.code === 200 && pm.response.json().token) {",
          "    pm.collectionVariables.set('jwt_token', pm.response.json().token);",
          "    console.log('JWT token updated:', pm.response.json().token.substring(0, 20) + '...');",
          "}",
          "",
          "// Auto-extract message ID from email send response",
          "if (pm.response.code === 202 && pm.response.json().messageId) {",
          "    pm.collectionVariables.set('message_id', pm.response.json().messageId);",
          "    console.log('Message ID captured:', pm.response.json().messageId);",
          "}"
        ]
      }
    }
  ]
}
